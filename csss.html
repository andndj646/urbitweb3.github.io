<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ğŸŒ Decentralized Search</title>
  <style>
    /* ===== å…¨å±€é‡ç½® & å“åº”å¼åŸºç¡€ ===== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bg: #ffffff;
      --text: #2d3748;
      --muted: #718096;
      --card-bg: #f8fafc;
      --border: #e2e8f0;
      --primary: #4299e1;
      --success: #48bb78;
      --warning: #ed8936;
      --shadow: 0 2px 8px rgba(0,0,0,0.08);
      --radius: 12px;
    }

    @media (prefers-color-scheme: dark) {
      :root {
        --bg: #1a202c;
        --text: #e2e8f0;
        --muted: #a0aec0;
        --card-bg: #2d3748;
        --border: #4a5568;
        --shadow: 0 2px 8px rgba(0,0,0,0.2);
      }
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Microsoft YaHei', sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
      padding: 16px;
      max-width: 800px;
      margin: 0 auto;
    }

    /* ===== å¤´éƒ¨ ===== */
    header {
      text-align: center;
      margin: 24px 0 16px;
    }

    h1 {
      font-size: 1.8rem;
      margin-bottom: 8px;
      background: linear-gradient(90deg, #4299e1, #805ad5);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }

    .subtitle {
      color: var(--muted);
      font-size: 0.95rem;
    }

    /* ===== æœç´¢æ¡† ===== */
    .search-container {
      position: sticky;
      top: 0;
      background: var(--bg);
      padding: 12px 0;
      z-index: 10;
      margin: -16px -16px 16px;
      backdrop-filter: blur(10px);
    }

    #q {
      width: 100%;
      padding: 14px 16px;
      font-size: 1rem;
      border: 1px solid var(--border);
      border-radius: var50px;
      background: var(--card-bg);
      color: var(--text);
      outline: none;
      transition: border-color 0.2s;
    }

    #q:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.2);
    }

    /* ===== çŠ¶æ€æ  ===== */
    #status {
      text-align: center;
      padding: 8px;
      font-size: 0.85rem;
      color: var(--muted);
      margin-bottom: 16px;
    }

    .status-live { color: var(--success); }
    .status-backup { color: var(--warning); }
    .status-error { color: #e53e3e; }

    /* ===== ç½‘ç«™å¡ç‰‡ ===== */
    .site {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 16px;
      margin-bottom: 16px;
      box-shadow: var(--shadow);
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .site:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .site h3 {
      margin-bottom: 8px;
      font-size: 1.15rem;
    }

    .site a {
      color: var(--primary);
      text-decoration: none;
      font-weight: 600;
    }

    .site a:hover {
      text-decoration: underline;
    }

    .description {
      color: var(--muted);
      margin: 8px 0;
      font-size: 0.95rem;
    }

    .tags {
      margin-top: 10px;
    }

    .tag {
      display: inline-block;
      background: rgba(66, 153, 225, 0.1);
      color: var(--primary);
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 0.8rem;
      margin-right: 6px;
      margin-bottom: 4px;
    }

    .url {
      display: block;
      color: var(--muted);
      font-size: 0.85rem;
      word-break: break-all;
      margin-top: 8px;
    }

    /* ===== æäº¤å…¥å£ ===== */
    .submit-link {
      display: inline-block;
      background: var(--primary);
      color: white !important;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 0.9rem;
      text-decoration: none !important;
      margin-top: 8px;
    }

    /* ===== ç©ºçŠ¶æ€ ===== */
    .empty {
      text-align: center;
      padding: 32px 0;
      color: var(--muted);
    }

    /* ===== Footer ===== */
    footer {
      text-align: center;
      margin-top: 32px;
      padding-top: 16px;
      border-top: 1px solid var(--border);
      color: var(--muted);
      font-size: 0.85rem;
    }

    @media (max-width: 600px) {
      body { padding: 12px; }
      h1 { font-size: 1.5rem; }
      .site { padding: 14px; }
    }
  </style>
</head>
<body>
  <header>
    <h1>Decentralized Search</h1>
    <p class="subtitle">Human-curated directory of clearnet & I2P sites</p>
    <p>
      <a href="https://github.com/yourname/search-dir/issues" target="_blank" class="submit-link">
        â• Add a Website
      </a>
    </p>
  </header>

  <div class="search-container">
    <input type="text" id="q" placeholder="Search by name, tag or description..." autofocus />
  </div>

  <div id="status">Loading index...</div>
  <div id="list"></div>

  <footer>
    <p>Works offline â€¢ No tracking â€¢ Data from server or Arweave backup</p>
  </footer>

  <script>
    // ===== é…ç½®åŒºï¼ˆä½ åªéœ€æ”¹è¿™ä¸¤è¡Œï¼‰=====
    const SERVER_URL = "http://yourdomain.com/sites.json";       // â† ä½ çš„æœåŠ¡å™¨åœ°å€
    const ARWEAVE_TXID = "YOUR_ARWEAVE_TXID";                   // â† Arweave å¤‡ä»½ TXID

    // ===== æ•°æ®åŠ è½½é€»è¾‘ =====
    async function loadData() {
      const statusEl = document.getElementById('status');
      statusEl.textContent = "Connecting to server...";
      statusEl.className = "";

      try {
        // å°è¯•ä»æœåŠ¡å™¨åŠ è½½
        const res = await fetch(SERVER_URL + "?t=" + Date.now(), {
          cache: 'no-store',
          mode: 'cors'
        });
        if (res.ok) {
          const data = await res.json();
          render(data, 'live');
          return;
        }
      } catch (e) {
        console.warn("Server load failed:", e);
      }

      // å›é€€åˆ° Arweave
      statusEl.textContent = "Server unavailable, loading backup...";
      try {
        const res = await fetch(`https://arweave.net/${ARWEAVE_TXID}`);
        if (res.ok) {
          const data = await res.json();
          render(data, 'backup');
          return;
        }
      } catch (e) {
        console.error("Arweave load failed:", e);
      }

      // å…¨éƒ¨å¤±è´¥
      statusEl.textContent = "âŒ All data sources failed";
      statusEl.className = "status-error";
      document.getElementById('list').innerHTML = 
        '<div class="empty">No data available. Please check back later.</div>';
    }

    function render(data, source) {
      const statusEl = document.getElementById('status');
      const now = new Date(data.last_updated);
      const timeStr = now.toLocaleString(navigator.language, {
        year: 'numeric',
        month: 'short',
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      });

      statusEl.innerHTML = source === 'live' 
        ? `âœ… Live data (v${data.version}) Â· Updated ${timeStr}`
        : `ğŸ’¾ Offline backup (v${data.version}) Â· Updated ${timeStr}`;
      statusEl.className = source === 'live' ? 'status-live' : 'status-backup';

      const listEl = document.getElementById('list');
      if (!data.sites || data.sites.length === 0) {
        listEl.innerHTML = '<div class="empty">No sites in index.</div>';
        return;
      }

      const q = document.getElementById('q').value.toLowerCase();
      const sites = q 
        ? data.sites.filter(s => 
            s.name.toLowerCase().includes(q) ||
            s.description.toLowerCase().includes(q) ||
            s.tags.some(t => t.toLowerCase().includes(q))
          )
        : data.sites;

      if (sites.length === 0) {
        listEl.innerHTML = '<div class="empty">No results found.</div>';
        return;
      }

      listEl.innerHTML = sites.map(s => `
        <div class="site">
          <h3><a href="${s.url}" target="_blank" rel="noopener">${s.name}</a></h3>
          <p class="description">${s.description}</p>
          <div class="tags">
            ${s.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
          </div>
          <small class="url">${s.url}</small>
        </div>
      `).join('');
    }

    // åˆå§‹åŒ–
    loadData();
    document.getElementById('q').addEventListener('input', () => {
      // é‡æ–°æ¸²æŸ“å½“å‰æ•°æ®ï¼ˆä¸é‡æ–°åŠ è½½ï¼‰
      const statusText = document.getElementById('status').textContent;
      if (statusText.includes('Live') || statusText.includes('Backup')) {
        // ä» window.lastData è·å–ï¼Ÿæˆ‘ä»¬æ¢ç§æ–¹å¼ï¼šç¼“å­˜æ•°æ®
        // ç®€åŒ–ï¼šé‡æ–°æ‰§è¡Œæ•´ä¸ªæµç¨‹ï¼ˆå®é™…å¯ä¼˜åŒ–ï¼Œä½†ä¸ºç®€æ´å…ˆè¿™æ ·ï¼‰
        loadData(); // æ³¨æ„ï¼šè¿™ä¼šé‡æ–°è¯·æ±‚ï¼Œç”Ÿäº§ç¯å¢ƒå»ºè®®ç¼“å­˜ data
      }
    });

    // æ›´ä¼˜æ–¹æ¡ˆï¼šç¼“å­˜ dataï¼ˆè¿›é˜¶å¯é€‰ï¼‰
    // ä½†ä¸ºä¿æŒä»£ç ç®€å•ï¼Œæ­¤å¤„æ¯æ¬¡æœç´¢éƒ½ reloadï¼ˆå› æ•°æ®å°ï¼Œå¯æ¥å—ï¼‰
  </script>
</body>
</html>
